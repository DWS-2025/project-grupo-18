<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link rel="stylesheet" href="/src/main/resources/static/css/profileStyles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Estilo para el botón de logout rojo */
        .logout-container {
            text-align: center;
            margin: 20px auto;
        }
        .logout-btn {
            background-color: #d32f2f;
            color: #fff;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .logout-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>

    <header class="header">
        <button class="back-btn" onclick="location.href='main.html'">⬅️ Atrás</button>
        <div class="logo">Catalex JobMatcher</div>
    </header>

    <div class="profile-container">
        <div class="profile-photo">
            <h2>Foto de Perfil</h2>
            <img src="https://static.vecteezy.com/system/resources/previews/036/280/651/non_2x/default-avatar-profile-icon-social-media-user-image-gray-avatar-icon-blank-profile-silhouette-illustration-vector.jpg" alt="Foto de perfil" id="profilePhoto">
            <button class="btn" onclick="location.href='changePhoto.html'">Cambiar Foto</button>
        </div>
        <section class="profile-info">
            <h2>Información del Perfil</h2>
            <ul>
                <li><strong>Email:</strong> <span id="email"></span></li>
                <li><strong>Teléfono:</strong> <span id="phone"></span></li>
                <li><strong>Ubicación:</strong> <span id="location"></span></li>
                <li><strong>Acerca de mí:</strong> <span id="about"></span></li>
            </ul>
            <div class="button-group">
                <button class="btn" onclick="location.href='profileEditor.html'">Editar Perfil</button>
            </div>
        </section>
    </div>

    <!-- Botón para cerrar sesión -->
    <div class="logout-container">
        <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
    </div>

    <script>
        // Obtener perfil desde el back-end
        fetch('/api/users/profile')
            .then(response => {
                if (!response.ok) {
                    throw new Error("Error al obtener los datos del perfil");
                }
                return response.json();
            })
            .then(profile => {
                if (profile.photo && profile.photo !== "") {
                    document.getElementById("profilePhoto").src = profile.photo;
                }
                document.getElementById("email").textContent = profile.email;
                document.getElementById("phone").textContent = profile.phone || "";
                document.getElementById("location").textContent = profile.location || "";
                document.getElementById("about").textContent = profile.about || "";
            })
            .catch(error => {
                console.error("Error fetching profile data:", error);
            });

        // Función para cerrar sesión y redirigir a index.html
        function logout() {
            fetch('/api/users/logout', { method: 'POST' })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error al cerrar sesión');
                    }
                    // Redirige a index.html tras cerrar sesión
                    window.location.href = 'index.html';
                })
                .catch(error => {
                    console.error("Error al cerrar sesión:", error);
                });
        }
    </script>

</body>
</html>